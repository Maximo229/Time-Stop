-- Time Stop Script by t.me/ArceusX7
-- Version 1.1 (Fixed)

local Player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

-- UI Creation (остаётся без изменений)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TimeStopGUI"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 250, 0, 150)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -75)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TitleBar.BackgroundTransparency = 0.1
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -40, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "TIME CONTROL"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Font = Enum.Font.Gotham
Title.TextSize = 14
Title.Parent = TitleBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -30, 0, 0)
MinimizeButton.BackgroundTransparency = 1
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.Gotham
MinimizeButton.TextSize = 18
MinimizeButton.Parent = TitleBar

-- Buttons Container
local ButtonsFrame = Instance.new("Frame")
ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Size = UDim2.new(1, -20, 1, -50)
ButtonsFrame.Position = UDim2.new(0, 10, 0, 40)
ButtonsFrame.BackgroundTransparency = 1
ButtonsFrame.Parent = MainFrame

-- Stop Time Button
local StopTimeButton = Instance.new("TextButton")
StopTimeButton.Name = "StopTimeButton"
StopTimeButton.Size = UDim2.new(1, 0, 0, 40)
StopTimeButton.Position = UDim2.new(0, 0, 0, 0)
StopTimeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
StopTimeButton.BackgroundTransparency = 0.2
StopTimeButton.Text = "STOP TIME"
StopTimeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StopTimeButton.Font = Enum.Font.Gotham
StopTimeButton.TextSize = 14
StopTimeButton.Parent = ButtonsFrame

local StopTimeCorner = Instance.new("UICorner")
StopTimeCorner.CornerRadius = UDim.new(0, 6)
StopTimeCorner.Parent = StopTimeButton

-- Resume Time Button
local ResumeTimeButton = Instance.new("TextButton")
ResumeTimeButton.Name = "ResumeTimeButton"
ResumeTimeButton.Size = UDim2.new(1, 0, 0, 40)
ResumeTimeButton.Position = UDim2.new(0, 0, 0, 50)
ResumeTimeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ResumeTimeButton.BackgroundTransparency = 0.2
ResumeTimeButton.Text = "DON'T STOP"
ResumeTimeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResumeTimeButton.Font = Enum.Font.Gotham
ResumeTimeButton.TextSize = 14
ResumeTimeButton.Parent = ButtonsFrame

local ResumeTimeCorner = Instance.new("UICorner")
ResumeTimeCorner.CornerRadius = UDim.new(0, 6)
ResumeTimeCorner.Parent = ResumeTimeButton

-- Signature
local Signature = Instance.new("TextLabel")
Signature.Name = "Signature"
Signature.Size = UDim2.new(1, -10, 0, 20)
Signature.Position = UDim2.new(0, 5, 1, -25)
Signature.BackgroundTransparency = 1
Signature.Text = "t.me/ArceusX7"
Signature.TextColor3 = Color3.fromRGB(150, 150, 150)
Signature.TextXAlignment = Enum.TextXAlignment.Right
Signature.Font = Enum.Font.Gotham
Signature.TextSize = 12
Signature.Parent = MainFrame

-- Minimized Button
local MinimizedButton = Instance.new("TextButton")
MinimizedButton.Name = "MinimizedButton"
MinimizedButton.Size = UDim2.new(0, 40, 0, 40)
MinimizedButton.Position = UDim2.new(0, 10, 0, 10)
MinimizedButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MinimizedButton.BackgroundTransparency = 0.2
MinimizedButton.Text = "T"
MinimizedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizedButton.Font = Enum.Font.Gotham
MinimizedButton.TextSize = 18
MinimizedButton.Visible = false
MinimizedButton.Parent = ScreenGui

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(0, 8)
MinimizedCorner.Parent = MinimizedButton

-- Variables
local TimeStopped = false
local ColorCorrection = Instance.new("ColorCorrectionEffect")
ColorCorrection.Name = "TimeStopEffect"
ColorCorrection.Saturation = 0
ColorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
ColorCorrection.Enabled = false
ColorCorrection.Parent = Lighting

-- Новый подход для остановки времени
local StoppedParts = {}

local function StopTime()
    if TimeStopped then return end
    
    TimeStopped = true
    ColorCorrection.Enabled = true
    TweenService:Create(ColorCorrection, TweenInfo.new(1), {Saturation = -1}):Play()
    
    -- Останавливаем все части кроме персонажа игрока
    StoppedParts = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and not obj:IsDescendantOf(Player.Character or Instance.new("Folder")) then
            StoppedParts[obj] = obj.Anchored
            obj.Anchored = true
        elseif obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
            StoppedParts[obj] = obj.Enabled
            obj.Enabled = false
        end
    end
end

local function ResumeTime()
    if not TimeStopped then return end
    
    TimeStopped = false
    TweenService:Create(ColorCorrection, TweenInfo.new(1), {Saturation = 0}):Play()
    
    -- Возвращаем всё в исходное состояние
    for obj, value in pairs(StoppedParts) do
        if obj:IsA("BasePart") then
            obj.Anchored = value
        elseif (obj:IsA("ParticleEmitter") or obj:IsA("Trail")) and obj.Parent then
            obj.Enabled = value
        end
    end
    StoppedParts = {}
    
    -- Отключаем эффект после анимации
    task.delay(1, function()
        if not TimeStopped then
            ColorCorrection.Enabled = false
        end
    end)
end

local function ToggleUI()
    MainFrame.Visible = not MainFrame.Visible
    MinimizedButton.Visible = not MainFrame.Visible
end

-- Connections
StopTimeButton.MouseButton1Click:Connect(StopTime)
ResumeTimeButton.MouseButton1Click:Connect(ResumeTime)
MinimizeButton.MouseButton1Click:Connect(ToggleUI)
MinimizedButton.MouseButton1Click:Connect(ToggleUI)

-- Обработка смерти персонажа
Player.CharacterAdded:Connect(function(character)
    if TimeStopped then
        -- Убедимся, что новые части персонажа не закреплены
        character.DescendantAdded:Connect(function(descendant)
            if descendant:IsA("BasePart") then
                descendant.Anchored = false
            end
        end)
        
        for _, descendant in ipairs(character:GetDescendants()) do
            if descendant:IsA("BasePart") then
                descendant.Anchored = false
            end
        end
    end
end)

-- Initial state
MainFrame.Visible = true
MinimizedButton.Visible = false
